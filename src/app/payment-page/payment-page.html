<div class="container">
  <div class="row g-5">
    
    <div class="col-md-5 col-lg-4 order-md-last">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-primary">Tu Pedido</span>
        <span class="badge bg-primary rounded-pill">{{ carrito().length }}</span>
      </h4>

      @if (carrito().length > 0) {
        <ul class="list-group mb-3">
          @for (item of carrito(); track item.pizza.nombre) {
            <li class="list-group-item d-flex justify-content-between lh-sm">
              <div>
                <h6 class="my-0">{{ item.cantidad }} x {{ item.pizza.nombre }}</h6>
              </div>
              <span class="text-body-secondary">{{ item.subtotal | number: '1.2-2' }} €</span>
            </li>
          }
          <li class="list-group-item d-flex justify-content-between">
            <span>Total (EUR)</span>
            <strong>{{ calcularTotal() | number: '1.2-2' }} €</strong>
          </li>
        </ul>
      } @else {
        <p class="text-muted">El carrito está vacío.</p>
      }
    </div>

    <div class="col-md-7 col-lg-8">
      <h4 class="mb-3">Información de Entrega y Pago</h4>
      
      <form [formGroup]="paymentForm" (ngSubmit)="pagar()" novalidate>
        <div class="row g-3">
          
          <div class="col-12">
            <label for="horaEntrega" class="form-label">Hora de Entrega</label>
            <input type="time" class="form-control" id="horaEntrega" formControlName="horaEntrega">
            @if (horaEntrega?.invalid && (horaEntrega?.dirty || horaEntrega?.touched)) {
              <div class="text-danger mt-1">
                @if (horaEntrega?.hasError('required')) {
                  <div>La hora de entrega es obligatoria.</div>
                }
              </div>
            }
          </div>

          <div class="col-12">
            <label for="direccion" class="form-label">Dirección</label>
            <textarea class="form-control" id="direccion" rows="3" formControlName="direccion"></textarea>
            @if (direccion?.invalid && (direccion?.dirty || direccion?.touched)) {
              <div class="text-danger mt-1">
                @if (direccion?.hasError('required')) {
                  <div>La dirección es obligatoria.</div>
                }
              </div>
            }
          </div>

          <div class="col-12 my-3">
            <h5 class="mb-2">Método de Pago</h5>
            <div class="form-check">
              <input id="tarjeta" type="radio" class="form-check-input" value="Tarjeta" formControlName="metodoPago">
              <label class="form-check-label" for="tarjeta">Tarjeta</label>
            </div>
            <div class="form-check">
              <input id="bizum" type="radio" class="form-check-input" value="Bizum" formControlName="metodoPago">
              <label class="form-check-label" for="bizum">Bizum</label>
            </div>
          </div>

          @if (metodoPago.value === 'Tarjeta') {
            <div class="col-12">
              <label for="numeroTarjeta" class="form-label">Número Tarjeta</label>
              <input type="text" class="form-control" id="numeroTarjeta" formControlName="numeroTarjeta" placeholder="1234123412341234">
              @if (numeroTarjeta?.invalid && (numeroTarjeta?.dirty || numeroTarjeta?.touched)) {
                <div class="text-danger mt-1">
                  @if (numeroTarjeta?.hasError('required')) {
                    <div>El número de tarjeta es obligatorio.</div>
                  }
                  @if (numeroTarjeta?.hasError('minlength') || numeroTarjeta?.hasError('maxlength') || numeroTarjeta?.hasError('pattern')) {
                    <div>La tarjeta debe tener 16 dígitos numéricos.</div>
                  }
                </div>
              }
            </div>
          }

          @if (metodoPago.value === 'Bizum') {
            <div class="col-12">
              <label for="numeroTelefono" class="form-label">Número Teléfono (Bizum)</label>
              <input type="tel" class="form-control" id="numeroTelefono" formControlName="numeroTelefono" placeholder="600123123">
              @if (numeroTelefono?.invalid && (numeroTelefono?.dirty || numeroTelefono?.touched)) {
                <div class="text-danger mt-1">
                  @if (numeroTelefono?.hasError('required')) {
                    <div>El teléfono es obligatorio para Bizum.</div>
                  }
                  @if (numeroTelefono?.hasError('minlength') || numeroTelefono?.hasError('maxlength') || numeroTelefono?.hasError('pattern')) {
                    <div>El teléfono debe tener 9 dígitos numéricos.</div>
                  }
                </div>
              }
            </div>
          }

        </div>

        <hr class="my-4">

        <div classd="d-flex justify-content-between">
          <button class="btn btn-danger btn-lg" type="button" (click)="limpiar()">
            LIMPIAR
          </button>
          <button class="btn btn-primary btn-lg" type="submit" [disabled]="paymentForm.invalid">
            PAGAR
          </button>
        </div>

      </form>
    </div>
  </div>
</div>